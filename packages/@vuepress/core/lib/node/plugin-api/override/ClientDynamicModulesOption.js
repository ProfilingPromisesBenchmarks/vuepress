'use strict'

/**
 * Module dependencies.
 */

const AsyncOption = require('../abstract/AsyncOption')

/**
 * clientDynamicModules option.
 */

module.exports = class ClientDynamicModulesOption extends AsyncOption {
  async apply (ctx) {
    await super.asyncApply()
    // DR-ASYNC REFACTOR AWAIT-IN-LOOP
    //    console.log("*** EXECUTING @vuepress/core/lib/node/plugin-api/override/ClientDynamicModulesOption.js:17:27");
    //     for (const { value, name: pluginName } of this.appliedItems) {
    //       const { name, content, dirname = 'dynamic' } = value
    //       await ctx.writeTemp(
    //         `${dirname}/${name}`,
    //         `
    // /**
    //  * Generated by "${pluginName}"
    //  */
    // ${content}\n\n
    //         `.trim())
    //     }

    await Promise.all(this.appliedItems.map(({ value, name: pluginName }) => {
      const { name, content, dirname = 'dynamic' } = value
      ctx.writeTemp(
        `${dirname}/${name}`,
        `
/**
* Generated by "${pluginName}"
*/
${content}\n\n
      `.trim())
    })
    )
  }
}
